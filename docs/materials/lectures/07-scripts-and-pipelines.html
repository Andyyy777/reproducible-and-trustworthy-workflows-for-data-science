
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Non-interactive scripts and data analysis pipelines &#8212; DSCI 310 Reproducible and Trustworthy Workflows for Data Science</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reproducible reports" href="08-reproducible-reports.html" />
    <link rel="prev" title="Introduction to testing code for data science" href="06-intro-to-testing-code.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/dsci-310-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">DSCI 310 Reproducible and Trustworthy Workflows for Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   Reproducible and Trustworthy Workflows for Data Science
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Course notes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-intro-to-ds-workflows.html">
   How do reproducible and trustworthy workflows impact data science?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-version-control-1.html">
   Version control for transparency and collaboration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-filenames-project-organization.html">
   Filenames and data science project organization, Integrated development environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-virtual-environments.html">
   Virtual environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-containerization.html">
   Managing dependencies using containerization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-intro-to-testing-code.html">
   Introduction to testing code for data science
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Non-interactive scripts and data analysis pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-reproducible-reports.html">
   Reproducible reports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09-packaging-and-documenting.html">
   Packaging and documenting code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10-continuous-integration.html">
   Automated testing and continuous integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11-deploy-and-publish.html">
   Deploying and publishing packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-licenses-and-copyright.html">
   Copyright and licenses
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/materials/lectures/07-scripts-and-pipelines.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/UBC-DSCI/reproducible-and-trustworthy-workflows-for-data-science"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/UBC-DSCI/reproducible-and-trustworthy-workflows-for-data-science/issues/new?title=Issue%20on%20page%20%2Fmaterials/lectures/07-scripts-and-pipelines.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UBC-DSCI/reproducible-and-trustworthy-workflows-for-data-science/master?urlpath=tree/materials/lectures/07-scripts-and-pipelines.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#topic-learning-objectives">
   Topic learning objectives
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-eval-print-loop-repl-framework-i-e-interactive-mode-versus-scripts">
     Read-eval-print-loop (REPL) framework (
     <em>
      i.e.,
     </em>
     interactive mode) versus Scripts
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-a-script">
   What is a script?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-write-scripts">
     Why write scripts?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scripts-in-r">
     Scripts in R
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#our-first-r-script">
       Our first R script:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-our-first-r-script">
       Running our first R script
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-couple-notes-about-scripts">
       A couple notes about scripts
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#script-structure-and-organization">
     Script structure and organization
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-r-script-organization">
       Example R script organization:
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Scripts in R:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#saving-things-from-scripts">
     Saving things from scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-command-line-arguments-in-r">
     Using command line arguments in R
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#positional-arguments-vs-options">
     Positional arguments vs options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-elements-arguments-or-options">
     Optional elements (arguments or options)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#improving-our-docs">
       Improving our docs
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#some-tips-for-rstudio-ide">
       Some tips for RStudio IDE:
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-analysis-pipelines">
   Data analysis pipelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#demo-building-a-data-analysis-pipeline-using-a-shell-script-tutorial">
     Demo: building a Data Analysis pipeline using a Shell script tutorial
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#set-up-instructions">
       Set-up instructions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#let-s-do-some-analysis">
       Let’s do some analysis!
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#another-example">
     Another example:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     Discussion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gnu-make-as-a-data-analysis-pipeline-tool">
   GNU Make as a data analysis pipeline tool
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#makefile-structure">
     Makefile Structure
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#structure-if-you-have-multiple-targets-from-a-scripts">
     Structure if you have multiple targets from a scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#demo-building-a-data-analysis-pipeline-using-make-a-tutorial">
     Demo: building a Data Analysis pipeline using Make, a tutorial
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Set-up instructions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finish-off-the-makefile">
     Finish off the Makefile!
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pattern-matching-and-variables-in-a-makefile">
     Pattern matching and variables in a Makefile
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="non-interactive-scripts-and-data-analysis-pipelines">
<h1>Non-interactive scripts and data analysis pipelines<a class="headerlink" href="#non-interactive-scripts-and-data-analysis-pipelines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="topic-learning-objectives">
<h2>Topic learning objectives<a class="headerlink" href="#topic-learning-objectives" title="Permalink to this headline">¶</a></h2>
<p>By the end of this topic, students should be able to:</p>
<ol class="simple">
<li><p>Explain when it is optimal to work in a read-eval-print-loop (REPL) framework and
when it is optimal to shift to using non-interactive scripts.</p></li>
<li><p>Be able to create simple scripts in R that can take input and be executed
from the command line.</p></li>
<li><p>Decide when to move from using command line arguments to pass variables into a
script to passing variables in via a configuration file, and create scripts that can read
configuration files.</p></li>
<li><p>Justify why analysis pipelines should be used over a single long script in data analysis
projects, specifically in regards to how this affects reproducibility, maintainability and
future derivatives of the work.</p></li>
<li><p>Write a simple automated analysis pipeline using workflow tool (e.g., GNU Make)</p></li>
<li><p>Discuss the advantage of using software that has a dependency graph for analysis
pipelines compared to software that does not.</p></li>
</ol>
<div class="section" id="read-eval-print-loop-repl-framework-i-e-interactive-mode-versus-scripts">
<h3>Read-eval-print-loop (REPL) framework (<em>i.e.,</em> interactive mode) versus Scripts<a class="headerlink" href="#read-eval-print-loop-repl-framework-i-e-interactive-mode-versus-scripts" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Up until now, we have primarily been using R and Python in an Read-eval-print-loop (REPL) framework (<em>i.e.,</em> interactive mode)</p></li>
<li><p>Read-eval-print-loop (REPL) framework (<em>i.e.,</em> interactive mode) is when we run our code in the console in R/Python, or in cells/chunks in the RStudio/Juptyer notebooks</p></li>
<li><p>A Read-eval-print-loop (REPL) framework (<em>i.e.,</em> interactive mode) is very useful for:</p>
<ul>
<li><p>solving small problems</p></li>
<li><p>developing code that will be knit to an analytic report</p></li>
<li><p>developing code that will be run as a script (i.e., in “batch” mode)</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="what-is-a-script">
<h2>What is a script?<a class="headerlink" href="#what-is-a-script" title="Permalink to this headline">¶</a></h2>
<p>An R/Python script is simply a plain text file containing (almost) the same commands that you would enter into R/Python’s console or in cells/chunks in the RStudio/Juptyer notebooks. We often run these from top to bottom from the command line/unix shell.</p>
<div class="section" id="why-write-scripts">
<h3>Why write scripts?<a class="headerlink" href="#why-write-scripts" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Efficiency!</p></li>
<li><p>Automation!</p></li>
<li><p>Reusable!</p></li>
<li><p>Record of what you have done!</p></li>
</ul>
</div>
<div class="section" id="scripts-in-r">
<h3>Scripts in R<a class="headerlink" href="#scripts-in-r" title="Permalink to this headline">¶</a></h3>
<p>Let’s start with a small, simple example to demonstrate how we write and run scripts in R (it is very similar in Python and we will get to this later in the lesson).</p>
<p>Our script will be called <code class="docutils literal notranslate"><span class="pre">print_mean_hp.R</span></code>, and it will calculate the mean horsepower of the cars from the built-in R data frame <code class="docutils literal notranslate"><span class="pre">mtcars</span></code>.</p>
<p>We will develop this script inside RStudio, make sure it works, and then run it from the command line/terminal/Git bash.</p>
<div class="section" id="our-first-r-script">
<h4>Our first R script:<a class="headerlink" href="#our-first-r-script" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># author: Tiffany Timbers
# date: 2020-01-15
#
# This script calculates the mean horsepower of the cars from the built-in 
# R data frame `mtcars`. This script takes no arguments.
#
# Usage: Rscript print_mean_hp.R

mean_hp &lt;- mean(mtcars$hp)
print(mean_hp)
</pre></div>
</div>
</div>
<div class="section" id="running-our-first-r-script">
<h4>Running our first R script<a class="headerlink" href="#running-our-first-r-script" title="Permalink to this headline">¶</a></h4>
<p>To run our R script, we need to open the command line/terminal/Git bash, and either navigate to the directory that houses the script OR point to it when we call it. We will do the former.</p>
<p>Then to run the R script, we use the <code class="docutils literal notranslate"><span class="pre">Rscript</span></code> command, followed by the name/path to the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rscript</span> <span class="n">print_mean_hp</span><span class="o">.</span><span class="n">R</span>
</pre></div>
</div>
<p>The output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">146.6875</span>
</pre></div>
</div>
</div>
<div class="section" id="a-couple-notes-about-scripts">
<h4>A couple notes about scripts<a class="headerlink" href="#a-couple-notes-about-scripts" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>If you want something to be output to the command line/terminal/Git bash, you <strong>should</strong> explicitly ask for it to be print. <em>This is not an absolute requirement in R, but it is in Python!</em></p></li>
<li><p>Similar with figures, they need to be saved! You will never see a figure created in a script unless you write it to a file.</p></li>
<li><p>From a reproducibility perspective, if we want input from the user, usually we will design the scripts to take command line arguments, and not use keyboard/user prompts.</p></li>
</ul>
</div>
</div>
<div class="section" id="script-structure-and-organization">
<h3>Script structure and organization<a class="headerlink" href="#script-structure-and-organization" title="Permalink to this headline">¶</a></h3>
<p>Although not necessary in R or Python, it is still good practice and advised to organize the code in your script into related sections. This practice keeps your code readable and organized. Below we outline how we typically organize R scripts:</p>
<div class="section" id="example-r-script-organization">
<h4>Example R script organization:<a class="headerlink" href="#example-r-script-organization" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># documentation comments</span>

<span class="c1"># load libraries/packages or source functions from other scripts</span>

<span class="c1"># parse/define command line arguments here</span>

<span class="c1"># code for &quot;guts&quot; of script goes here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Scripts in R:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Here we write a script called <code class="docutils literal notranslate"><span class="pre">quick_titanic_fare_mean.R</span></code> which reads in the <a class="reference external" href="https://raw.githubusercontent.com/ttimbers/rscript-demo/main/data/titanic.csv">titanic dataset</a> (<em>original source: <a class="reference external" href="https://biostat.app.vumc.org/wiki/Main/DataSets">https://biostat.app.vumc.org/wiki/Main/DataSets</a></em>) and calculates the  mean for the fare (ticket price) variable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># author: Tiffany Timbers</span>
<span class="c1"># date: 2020-01-15</span>
<span class="c1">#</span>
<span class="c1"># This script calculates the mean for the fare (ticket price)</span>
<span class="c1"># from titanic.csv. This script takes no arguments.</span>
<span class="c1">#</span>
<span class="c1"># Usage: quick_titanic_fare_mean.R</span>

<span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/titanic.csv&#39;</span><span class="p">)</span>

<span class="n">out</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span>
         <span class="n">pull</span><span class="p">(</span><span class="n">fare</span><span class="p">)</span> <span class="o">%&gt;%</span>
         <span class="n">mean</span><span class="p">(</span><span class="n">na</span><span class="o">.</span><span class="n">rm</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>Wait! Other languages use a <code class="docutils literal notranslate"><span class="pre">main</span></code> function (so you can, for example, import and access parts of the code into other code docs) - why are we not doing this here? I truly do not know the answer (yet) to why not, however, it is not commonly done:</p>
<a class="reference internal image-reference" href="../../_images/twitter-poll.png"><img alt="../../_images/twitter-poll.png" src="../../_images/twitter-poll.png" style="width: 600px;" /></a>
<p>Perhaps this is due to historical origins and culture of the R programming language and it’s user base?
A follow-up question is, can you do this if you want? That question I can answer with a yes, see below for an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>main &lt;- function() {
  # script code
}


if (!interactive()) {
  main()
}
</pre></div>
</div>
<div class="section" id="saving-things-from-scripts">
<h3>Saving things from scripts<a class="headerlink" href="#saving-things-from-scripts" title="Permalink to this headline">¶</a></h3>
<p>Above we just printed the mean to the terminal.
That is was done because the purpose of that script
was to have a very simple illustration of how to create and run scripts in R.
However, in practice, we typically want to save our analysis artifacts (figures, tables, values, etc)
to disc so that we can load them into other files
(e.g., our final reports to communicate our analysis findings).</p>
<p>Below we show an example of how we would use <code class="docutils literal notranslate"><span class="pre">readr::write_csv</span></code>
to save the mean value we calculated to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># author: Tiffany Timbers
# date: 2020-01-15
#
# This script calculates the mean horsepower of the cars from the built-in 
# R data frame `mtcars` and saves it to `results/mean_hp_col.csv`. 
# This script takes no arguments.
#
# Usage: Rscript print_mean_hp.R

library(readr)

mean_hp &lt;- mean(mtcars$hp)
mean_hp &lt;- data.frame(value = mean_hp)
write_csv(mean_hp, &quot;results/mean_hp_col.csv&quot;)
</pre></div>
</div>
<blockquote>
<div><p>Note: in this script we are saving the file to the results directory.
There needs to be a results directory created before this script would work.</p>
</div></blockquote>
</div>
<div class="section" id="using-command-line-arguments-in-r">
<h3>Using command line arguments in R<a class="headerlink" href="#using-command-line-arguments-in-r" title="Permalink to this headline">¶</a></h3>
<p>Let’s make our script more flexible, and let us specify what column variable we want to calculate the mean for when we call the script.</p>
<p>To do this, we use the <code class="docutils literal notranslate"><span class="pre">docopt</span></code> R package. This will allow us to collect the text we enter at the command line when we call the script, and make it available to us when we run the script.</p>
<p>When we run <code class="docutils literal notranslate"><span class="pre">docopt</span></code> it takes the text we entered at the command line and gives it to us as a named list of the text provided after the script name. The names of the items in the list come from the documentation. Whitespace at the command line is what is used to parse the text into separate items in the vector.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># author: Tiffany Timbers
# date: 2020-01-15

&quot;This script calculates the mean for a specified column
from titanic.csv.

Usage: quick_titanic_col_mean.R &lt;col&gt;
&quot; -&gt; doc


library(tidyverse)
library(docopt)

opt &lt;- docopt(doc)

data &lt;- read_csv(&#39;data/titanic.csv&#39;)

out &lt;- data %&gt;%
         pull(!!opt$col) %&gt;%
         mean(na.rm = TRUE)

print(out)
</pre></div>
</div>
<blockquote>
<div><p>Note: we use <code class="docutils literal notranslate"><span class="pre">!!</span></code> in front of <code class="docutils literal notranslate"><span class="pre">opt$col</span></code> because all command line arguments are passed into R
as strings, and are thus quoted. However, <code class="docutils literal notranslate"><span class="pre">pull</span></code> is a function from the <code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> that expects
an unquoted column name of a data frame. <code class="docutils literal notranslate"><span class="pre">!!</span></code> does this unquoting.
This is similar to <code class="docutils literal notranslate"><span class="pre">{{</span></code> that we saw before with functions
(which quotes and unquotes values when they are passed into functions).
However here we use <code class="docutils literal notranslate"><span class="pre">!!</span></code> as we have no indirection and just need to perform unquoting.</p>
</div></blockquote>
<p>And we would run a script like this from the command line as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">quick_titanic_col_mean</span><span class="o">.</span><span class="n">R</span> <span class="n">fare</span>
</pre></div>
</div>
<p>Let’s make our script even more flexible, and let us specify that dataset as well (we could then use it more generally on other files, such as the Gapminder <code class="docutils literal notranslate"><span class="pre">.csv</span></code>’s we saw in Block 1).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># author: Tiffany Timbers
# date: 2020-01-15

&quot;This script calculates the mean for any numerical vector
from a csv file. This script takes an unquoted column name and a data file path.

Usage: quick_csv_col_mean.R &lt;file_path&gt; &lt;col&gt;
&quot; -&gt; doc


library(tidyverse)
library(docopt)

opt &lt;- docopt(doc)

data &lt;- read_csv(opt$file_path)

out &lt;- data %&gt;%
         pull(!!opt$col) %&gt;%
         mean(na.rm = TRUE)

print(out)
</pre></div>
</div>
<p>Now we would run a script like this from the command line as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">quick_csv_col_mean</span><span class="o">.</span><span class="n">R</span> <span class="n">data</span><span class="o">/</span><span class="n">titanic</span><span class="o">.</span><span class="n">csv</span> <span class="n">fare</span>
</pre></div>
</div>
</div>
<div class="section" id="positional-arguments-vs-options">
<h3>Positional arguments vs options<a class="headerlink" href="#positional-arguments-vs-options" title="Permalink to this headline">¶</a></h3>
<p>In the examples above, we used <code class="docutils literal notranslate"><span class="pre">docopt</span></code> to specify positional arguments. This means that the order matters! If we change the order of the values of the arguments at the command line, our script will likely throw an error, because it will try to perform the wrong operations on the wrong values.</p>
<p>Another downside to positional arguments, is that without good documentation, they can be less readable. And certainly the call to the script to is less readable. We can instead give the arguments names using <code class="docutils literal notranslate"><span class="pre">--ARGUMENT_NAME</span></code> syntax. We call these “options”. Below is the same script but specified using options as opposed to positional arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># author: Tiffany Timbers
# date: 2020-01-15

&quot;This script calculates the mean for any numerical vector
from a csv file. This script takes an unquoted column name and a data file path.

Usage: quick_csv_col_mean.R --file_path=&lt;file_path&gt; --col=&lt;col&gt;

Options:
--file_path=&lt;file_path&gt;   Path to the data file
--col=&lt;col&gt;               Unquoted column name of the numerical vector for which to calculate the mean
&quot; -&gt; doc


library(tidyverse)
library(docopt)

opt &lt;- docopt(doc)

data &lt;- read_csv(opt$file_path)

out &lt;- data %&gt;%
         pull(!!opt$col) %&gt;%
         mean(na.rm = TRUE)

print(out)
</pre></div>
</div>
<p>And we would run a script like this that uses options like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">quick_csv_col_mean</span><span class="o">.</span><span class="n">R</span> <span class="o">--</span><span class="n">file_path</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">titanic</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">col</span><span class="o">=</span><span class="n">fare</span>
</pre></div>
</div>
<p>or like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">quick_csv_col_mean</span><span class="o">.</span><span class="n">R</span> <span class="o">--</span><span class="n">col</span><span class="o">=</span><span class="n">fare</span> <span class="o">--</span><span class="n">file_path</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">titanic</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>because we gave the arguments names, and thus their position no longer matters!</p>
</div>
<div class="section" id="optional-elements-arguments-or-options">
<h3>Optional elements (arguments or options)<a class="headerlink" href="#optional-elements-arguments-or-options" title="Permalink to this headline">¶</a></h3>
<p>If you would like an argument or option to be “optional” (i.e., not required!) enclose them with the square brackets “[ ]”  in the documentation.</p>
<div class="section" id="improving-our-docs">
<h4>Improving our docs<a class="headerlink" href="#improving-our-docs" title="Permalink to this headline">¶</a></h4>
<p>We can improve our docs further by adding an “Options” section with {docopt}:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># author: Tiffany Timbers
# date: 2020-01-15

&quot;This script calculates the mean for any numerical vector
from a csv file. This script takes an unquoted column name and a data file path.

Usage: quick_csv_col_mean.R --file_path=&lt;file_path&gt; --col=&lt;col&gt;

Options:
--file_path=&lt;file_path&gt;   Path to the data file
--col=&lt;col&gt;               Unquoted column name of the numerical vector for which to calculate the mean
&quot; -&gt; doc


library(tidyverse)
library(docopt)

opt &lt;- docopt(doc)

data &lt;- read_csv(opt$file_path)

out &lt;- data %&gt;%
         pull(!!opt$col) %&gt;%
         mean(na.rm = TRUE)

print(out)
</pre></div>
</div>
<p>And then the user can see these docs by calling the script from the command line and using the <code class="docutils literal notranslate"><span class="pre">--help</span></code> to get this information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">script</span> <span class="n">calculates</span> <span class="n">the</span> <span class="n">mean</span> <span class="k">for</span> <span class="nb">any</span> <span class="n">numerical</span> <span class="n">vector</span>
<span class="kn">from</span> <span class="nn">a</span> <span class="n">csv</span> <span class="n">file</span><span class="o">.</span> <span class="n">This</span> <span class="n">script</span> <span class="n">takes</span> <span class="n">an</span> <span class="n">unquoted</span> <span class="n">column</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">data</span> <span class="n">file</span> <span class="n">path</span><span class="o">.</span>

<span class="n">Usage</span><span class="p">:</span> <span class="n">quick_csv_col_mean</span><span class="o">.</span><span class="n">R</span> <span class="o">--</span><span class="n">file_path</span><span class="o">=&lt;</span><span class="n">file_path</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">col</span><span class="o">=&lt;</span><span class="n">col</span><span class="o">&gt;</span>

<span class="n">Options</span><span class="p">:</span>
<span class="o">--</span><span class="n">file_path</span><span class="o">=&lt;</span><span class="n">file_path</span><span class="o">&gt;</span>   <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">data</span> <span class="n">file</span>
<span class="o">--</span><span class="n">col</span><span class="o">=&lt;</span><span class="n">col</span><span class="o">&gt;</span>               <span class="n">Unquoted</span> <span class="n">column</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">numerical</span> <span class="n">vector</span> <span class="k">for</span> <span class="n">which</span> <span class="n">to</span> <span class="n">calculate</span> <span class="n">the</span> <span class="n">mean</span>
</pre></div>
</div>
</div>
<div class="section" id="some-tips-for-rstudio-ide">
<h4>Some tips for RStudio IDE:<a class="headerlink" href="#some-tips-for-rstudio-ide" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>To indent a block of text, highlight and use tab</p></li>
<li><p>To fix indenting in general to R code standards, use Command/Cntrl + I</p></li>
<li><p>To get multiple cursors, hold alt/option and highlight lines using cursor</p></li>
<li><p>To get multiple cursors to the beginning of the line, use control A</p></li>
<li><p>To get multiple cursors to the end of the line, use control E</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="data-analysis-pipelines">
<h2>Data analysis pipelines<a class="headerlink" href="#data-analysis-pipelines" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>As analysis grows in length and complexity, one literate code document generally is not enough</p></li>
<li><p>To improve code report readability (and code reproducibility and modularity) it is better to abstract at least parts of the code away (e.g, to scripts)</p></li>
<li><p>These scripts save figures and tables that will be imported into the final report</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/scripts.png"><img alt="../../_images/scripts.png" src="../../_images/scripts.png" style="width: 600px;" /></a>
<div class="section" id="demo-building-a-data-analysis-pipeline-using-a-shell-script-tutorial">
<h3>Demo: building a Data Analysis pipeline using a Shell script tutorial<a class="headerlink" href="#demo-building-a-data-analysis-pipeline-using-a-shell-script-tutorial" title="Permalink to this headline">¶</a></h3>
<p>adapted from <a class="reference external" href="http://software-carpentry.org/">Software Carpentry</a></p>
<p>To illustrate how to make a data analysis pipeline using a shell script to drive other scripts, we will work through an example together. Here are some set-up instructions so that we can do this together:</p>
<div class="section" id="set-up-instructions">
<h4>Set-up instructions<a class="headerlink" href="#set-up-instructions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Download <a class="reference external" href="https://github.com/ttimbers/data_analysis_pipeline_eg/archive/v1.0.zip">data_analysis_pipeline_eg-1.0.zip</a></p></li>
<li><p>Unzip it and change into the <code class="docutils literal notranslate"><span class="pre">data_analysis_pipeline_eg-1.0</span></code> directory.</p></li>
</ul>
</div>
<div class="section" id="let-s-do-some-analysis">
<h4>Let’s do some analysis!<a class="headerlink" href="#let-s-do-some-analysis" title="Permalink to this headline">¶</a></h4>
<p>Suppose we have a script, <code class="docutils literal notranslate"><span class="pre">wordcount.py</span></code>, that reads in a text file,
counts the words in this text file, and outputs a data file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python src/wordcount.py data/isles.txt results/isles.dat
</pre></div>
</div>
<p>If we view the first 5 rows of the data file using <code class="docutils literal notranslate"><span class="pre">head</span></code>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ head -5 results/isles.dat
</pre></div>
</div>
<p>we can see that the file consists of one row per word. Each row shows the word itself,
the number of occurrences of that word, and the number of occurrences as a percentage of
the total number of words in the text file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the</span> <span class="mi">3822</span> <span class="mf">6.7371760973</span>
<span class="n">of</span> <span class="mi">2460</span> <span class="mf">4.33632998414</span>
<span class="ow">and</span> <span class="mi">1723</span> <span class="mf">3.03719372466</span>
<span class="n">to</span> <span class="mi">1479</span> <span class="mf">2.60708619778</span>
<span class="n">a</span> <span class="mi">1308</span> <span class="mf">2.30565838181</span>
</pre></div>
</div>
<p>Suppose we also have a script, <code class="docutils literal notranslate"><span class="pre">plotcount.py</span></code>, that reads in a data
file and save a plot of the 10 most frequently occurring words:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python src/plotcount.py results/isles.dat results/figure/isles.png
</pre></div>
</div>
<p>Together these scripts implement a data analysis pipeline:</p>
<ol class="simple">
<li><p>Read a data file.</p></li>
<li><p>Perform an analysis on this data file.</p></li>
<li><p>Write the analysis results to a new file.</p></li>
<li><p>Plot a graph of the analysis results.</p></li>
</ol>
<p>To document how we’d like the analysis to be run, so we (and others) have a record and
can replicate it, we will build a shell script called <code class="docutils literal notranslate"><span class="pre">run_all.sh</span></code>. Let’s work to try
to build this pipeline so it does all that!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># run_all.sh</span>
<span class="c1"># Tiffany Timbers, Nov 2017</span>
<span class="c1">#</span>
<span class="c1"># This driver script completes the textual analysis of</span>
<span class="c1"># 3 novels and creates figures on the 10 most frequently</span>
<span class="c1"># occuring words from each of the 3 novels. This script</span>
<span class="c1"># takes no arguments.</span>
<span class="c1">#</span>
<span class="c1"># Usage: bash run_all.sh</span>

<span class="c1"># perform wordcout on novels</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>

<span class="c1"># create plots</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>We actually have 4 books that we want to analyze, and then put the figures in a report.</p>
<ol class="simple">
<li><p>Read a data file.</p></li>
<li><p>Perform an analysis on this data file.</p></li>
<li><p>Write the analysis results to a new file.</p></li>
<li><p>Plot a graph of the analysis results.</p></li>
<li><p>Save the graph as an image, so we can put it in a paper.</p></li>
</ol>
<p>Let’s extend our shell script to do that!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># run_all.sh</span>
<span class="c1"># Tiffany Timbers, Nov 2018</span>

<span class="c1"># This driver script completes the textual analysis of</span>
<span class="c1"># 3 novels and creates figures on the 10 most frequently</span>
<span class="c1"># occuring words from each of the 3 novels. This script</span>
<span class="c1"># takes no arguments.</span>

<span class="c1"># example usage:</span>
<span class="c1"># bash run_all.sh</span>

<span class="c1"># count the words</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span>

<span class="c1"># create the plots</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">png</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">png</span>

<span class="c1"># write the report</span>
<span class="n">Rscript</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;rmarkdown::render(&#39;doc/count_report.Rmd&#39;)&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="another-example">
<h3>Another example:<a class="headerlink" href="#another-example" title="Permalink to this headline">¶</a></h3>
<p>From the <a class="reference external" href="https://github.com/ttimbers/breast_cancer_predictor">breast cancer prediction example analysis repo</a>, here is a data analysis pipeline using a shell script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># run_all.sh</span>
<span class="c1"># Tiffany Timbers, Jan 2020</span>

<span class="c1"># download data</span>
<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">download_data</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">out_type</span><span class="o">=</span><span class="n">feather</span> <span class="o">--</span><span class="n">url</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">ics</span><span class="o">.</span><span class="n">uci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">ml</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">learning</span><span class="o">-</span><span class="n">databases</span><span class="o">/</span><span class="n">breast</span><span class="o">-</span><span class="n">cancer</span><span class="o">-</span><span class="n">wisconsin</span><span class="o">/</span><span class="n">wpbc</span><span class="o">.</span><span class="n">data</span> <span class="o">--</span><span class="n">out_file</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">wdbc</span><span class="o">.</span><span class="n">feather</span>

<span class="c1"># run eda report</span>
<span class="n">Rscript</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;rmarkdown::render(&#39;src/breast_cancer_eda.Rmd&#39;)&quot;</span>

<span class="c1"># pre-process data </span>
<span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">pre_process_wisc</span><span class="o">.</span><span class="n">r</span> <span class="o">--</span><span class="nb">input</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">wdbc</span><span class="o">.</span><span class="n">feather</span> <span class="o">--</span><span class="n">out_dir</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">processed</span> 

<span class="c1"># create exploratory data analysis figure and write to file </span>
<span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">eda_wisc</span><span class="o">.</span><span class="n">r</span> <span class="o">--</span><span class="n">train</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">training</span><span class="o">.</span><span class="n">feather</span> <span class="o">--</span><span class="n">out_dir</span><span class="o">=</span><span class="n">results</span>

<span class="c1"># tune model</span>
<span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">fit_breast_cancer_predict_model</span><span class="o">.</span><span class="n">r</span> <span class="o">--</span><span class="n">train</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">training</span><span class="o">.</span><span class="n">feather</span> <span class="o">--</span><span class="n">out_dir</span><span class="o">=</span><span class="n">results</span>

<span class="c1"># test model</span>
<span class="n">Rscript</span> <span class="n">src</span><span class="o">/</span><span class="n">breast_cancer_test_results</span><span class="o">.</span><span class="n">r</span> <span class="o">--</span><span class="n">test</span><span class="o">=</span><span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">feather</span> <span class="o">--</span><span class="n">out_dir</span><span class="o">=</span><span class="n">results</span>

<span class="c1"># render final report</span>
<span class="n">Rscript</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;rmarkdown::render(&#39;doc/breast_cancer_predict_report.Rmd&#39;, output_format = &#39;github_document&#39;)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="discussion">
<h3>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What are the advantages to using a data analysis pipeline?</p></li>
<li><p>How “good” is a shell script as a data analysis pipeline? What might not be ideal about this?</p></li>
</ul>
</div>
</div>
<div class="section" id="gnu-make-as-a-data-analysis-pipeline-tool">
<h2>GNU Make as a data analysis pipeline tool<a class="headerlink" href="#gnu-make-as-a-data-analysis-pipeline-tool" title="Permalink to this headline">¶</a></h2>
<p>We previously built a data analysis pipeline by using a shell script (we called it <code class="docutils literal notranslate"><span class="pre">run_all.sh</span></code>) to piece together and create a record of all the scripts and arguments we used in our analysis. That is a step in the right direction, but there were a few unsatisfactory things about this strategy:</p>
<ol class="simple">
<li><p>It takes time to manually erase all intermediate and final files generated by analysis to do a complete test to see that everything is working from top to bottom</p></li>
<li><p>It runs every step every time. This can be problematic if some steps take a long time and you have only changed other, smaller parts of the analysis</p></li>
</ol>
<p>Thus, to improve on this we are going to use the build and automation tool, Make, to make a smarter
data analysis pipeline.</p>
<div class="section" id="makefile-structure">
<h3>Makefile Structure<a class="headerlink" href="#makefile-structure" title="Permalink to this headline">¶</a></h3>
<p>Each block of code in a Makefile is called a rule, it looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file_to_create</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">data_it_depends_on</span><span class="o">.</span><span class="n">dat</span> <span class="n">script_it_depends_on</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">script_it_depends_on</span><span class="o">.</span><span class="n">py</span> <span class="n">data_it_depends_on</span><span class="o">.</span><span class="n">dat</span> <span class="n">file_to_create</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">file_to_create.png</span></code> is a target, a file to be created, or built.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_it_depends_on.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">script_it_depends_on.py</span></code> are dependencies, files which are needed to build or update the target. Targets can have zero or more dependencies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code> separates targets from dependencies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">script_it_depends_on.py</span> <span class="pre">data_it_depends_on.dat</span> <span class="pre">file_to_create.png</span></code> is an action, a command to run to build or update the target using the dependencies. Targets can have zero or more actions. Actions are indented using the TAB character, not 8 spaces.</p></li>
<li><p>Together, the target, dependencies, and actions form a rule.</p></li>
</ul>
</div>
<div class="section" id="structure-if-you-have-multiple-targets-from-a-scripts">
<h3>Structure if you have multiple targets from a scripts<a class="headerlink" href="#structure-if-you-have-multiple-targets-from-a-scripts" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file_to_create_1</span><span class="o">.</span><span class="n">png</span> <span class="n">file_to_create_2</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">data_it_depends_on</span><span class="o">.</span><span class="n">dat</span> <span class="n">script_it_depends_on</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">script_it_depends_on</span><span class="o">.</span><span class="n">py</span> <span class="n">data_it_depends_on</span><span class="o">.</span><span class="n">dat</span> <span class="n">file_to_create</span>
</pre></div>
</div>
</div>
<div class="section" id="demo-building-a-data-analysis-pipeline-using-make-a-tutorial">
<h3>Demo: building a Data Analysis pipeline using Make, a tutorial<a class="headerlink" href="#demo-building-a-data-analysis-pipeline-using-make-a-tutorial" title="Permalink to this headline">¶</a></h3>
<p>adapted from <a class="reference external" href="http://software-carpentry.org/">Software Carpentry</a></p>
<div class="section" id="id2">
<h4>Set-up instructions<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Download <a class="reference external" href="https://github.com/ttimbers/data_analysis_pipeline_eg/archive/v2.0.zip">data_analysis_pipeline_eg-2.0.zip</a></p></li>
<li><p>Unzip it and change into the <code class="docutils literal notranslate"><span class="pre">data_analysis_pipeline_eg-2.0</span></code> directory.</p></li>
<li><p>note - the tutorial in <span class="xref myst">lecture 4</span> is a prerequisite</p></li>
</ul>
<p>Good reference: http://swcarpentry.github.io/make-novice/reference</p>
<p>Create a file, called <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count words.</span>
<span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>This is a simple build file, which for
Make is called a Makefile - a file executed
by Make. Let us go through each line in turn:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#</span></code> denotes a <em>comment</em>. Any text from <code class="docutils literal notranslate"><span class="pre">#</span></code> to the end of the line is
ignored by Make.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">results/isles.dat</span></code> is a <a class="reference external" href="http://swcarpentry.github.io/make-novice/reference#target">target</a>, a file to be
created, or built.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data/isles.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">src/wordcount.py</span></code> are <a class="reference external" href="http://swcarpentry.github.io/make-novice/reference#dependency">dependencies</a>, a
file that is needed to build or update the target. Targets can have
zero or more dependencies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code> separates targets from dependencies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">src/wordcount.py</span> <span class="pre">data/isles.txt</span> <span class="pre">isles.dat</span></code> is an
<a class="reference external" href="http://swcarpentry.github.io/make-novice/reference#action">action</a>, a command to run to build or update
the target using the dependencies. Targets can have zero or more
actions.</p></li>
<li><p>Actions are indented using the TAB character, <em>not</em> 8 spaces. This
is a legacy of Make’s 1970’s origins.</p></li>
<li><p>Together, the target, dependencies, and actions form a
<a class="reference external" href="http://swcarpentry.github.io/make-novice/reference#rule">rule</a>.</p></li>
</ul>
<p>Our rule above describes how to build the target <code class="docutils literal notranslate"><span class="pre">results/isles.dat</span></code> using the
action <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">src/wordcount.py</span></code> and the dependency <code class="docutils literal notranslate"><span class="pre">data/isles.txt</span></code>.</p>
<p>By default, Make looks for a Makefile, called <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, and we can
run Make as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make
</pre></div>
</div>
<p>Make prints out the actions it executes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>If we see,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Makefile</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span> <span class="o">***</span> <span class="n">missing</span> <span class="n">separator</span><span class="o">.</span>  <span class="n">Stop</span><span class="o">.</span>
</pre></div>
</div>
<p>then we have used a space instead of a TAB characters to indent one of
our actions.</p>
<p>We don’t have to call our Makefile <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. However, if we call it
something else we need to tell Make where to find it. This we can do
using <code class="docutils literal notranslate"><span class="pre">-f</span></code> flag. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make -f Makefile
</pre></div>
</div>
<p>As we have re-run our Makefile, Make now informs us that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>make: `results/isles.dat&#39; is up to date.
</pre></div>
</div>
<p>This is because our target, <code class="docutils literal notranslate"><span class="pre">results/isles.dat</span></code>, has now been created, and
Make will not create it again. To see how this works, let’s pretend to
update one of the text files. Rather than opening the file in an
editor, we can use the shell <code class="docutils literal notranslate"><span class="pre">touch</span></code> command to update its timestamp
(which would happen if we did edit the file):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ touch data/isles.txt
</pre></div>
</div>
<p>If we compare the timestamps of <code class="docutils literal notranslate"><span class="pre">data/isles.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">results/isles.dat</span></code>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls -l data/isles.txt results/isles.dat
</pre></div>
</div>
<p>then we see that <code class="docutils literal notranslate"><span class="pre">results/isles.dat</span></code>, the target, is now older
than<code class="docutils literal notranslate"><span class="pre">data/isles.txt</span></code>, its dependency:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="n">mjj</span>      <span class="n">Administ</span>   <span class="mi">323972</span> <span class="n">Jun</span> <span class="mi">12</span> <span class="mi">10</span><span class="p">:</span><span class="mi">35</span> <span class="n">books</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>    <span class="mi">1</span> <span class="n">mjj</span>      <span class="n">Administ</span>   <span class="mi">182273</span> <span class="n">Jun</span> <span class="mi">12</span> <span class="mi">09</span><span class="p">:</span><span class="mi">58</span> <span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>If we run Make again,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make
</pre></div>
</div>
<p>then it recreates <code class="docutils literal notranslate"><span class="pre">results/isles.dat</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>When it is asked to build a target, Make checks the ‘last modification
time’ of both the target and its dependencies. If any dependency has
been updated since the target, then the actions are re-run to update
the target.</p>
<p>We may want to remove all our data files so we can explicitly recreate
them all. We can introduce a new target, and associated rule, <code class="docutils literal notranslate"><span class="pre">clean</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>

<span class="n">clean</span> <span class="p">:</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/*.</span><span class="n">dat</span>
</pre></div>
</div>
<p>This is an example of a rule that has no dependencies. <code class="docutils literal notranslate"><span class="pre">clean</span></code> has no
dependencies on any <code class="docutils literal notranslate"><span class="pre">.dat</span></code> file as it makes no sense to create these
just to remove them. We just want to remove the data files whether or
not they exist. If we run Make and specify this target,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make clean
</pre></div>
</div>
<p>then we get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">*.</span><span class="n">dat</span>
</pre></div>
</div>
<p>There is no actual thing built called <code class="docutils literal notranslate"><span class="pre">clean</span></code>. Rather, it is a
short-hand that we can use to execute a useful sequence of
actions. Such targets, though very useful, can lead to problems. For
example, let us recreate our data files, create a directory called
<code class="docutils literal notranslate"><span class="pre">clean</span></code>, then run Make:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make results/isles.dat
$ mkdir clean
$ make clean
</pre></div>
</div>
<p>We get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>make: `clean&#39; is up to date.
</pre></div>
</div>
<p>Let’s add another rule to the end of <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>

<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span>

<span class="n">clean</span> <span class="p">:</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/*.</span><span class="n">dat</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/*.</span><span class="n">png</span>
</pre></div>
</div>
<p>the new target isles.png depends on the target isles.dat. So to make both, we can simply
type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make isles.dat
$ ls
</pre></div>
</div>
<p>Let’s add another book:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>

<span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
  <span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span>

<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span>

<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>
  <span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span>

<span class="n">clean</span> <span class="p">:</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/*.</span><span class="n">dat</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/*.</span><span class="n">png</span>
</pre></div>
</div>
<p>To run all of the commands, we need to type make <TARGET> for each one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make isles.png
$ make abyss.png
</pre></div>
</div>
<p>OR we can add a target <code class="docutils literal notranslate"><span class="pre">all</span></code> which will build the last of the dependencies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">all</span><span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span>

<span class="c1"># count words</span>
<span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
	
<span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span>

<span class="c1"># plot word count</span>
<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">isles</span><span class="o">.</span><span class="n">png</span>

<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">abyss</span><span class="o">.</span><span class="n">png</span>

<span class="n">clean</span> <span class="p">:</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/*.</span><span class="n">dat</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/*.</span><span class="n">png</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="finish-off-the-makefile">
<h3>Finish off the Makefile!<a class="headerlink" href="#finish-off-the-makefile" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Makefile</span>
<span class="c1"># Tiffany Timbers, Nov 2018</span>

<span class="c1"># This driver script completes the textual analysis of</span>
<span class="c1"># 3 novels and creates figures on the 10 most frequently</span>
<span class="c1"># occuring words from each of the 3 novels. This script</span>
<span class="c1"># takes no arguments.</span>

<span class="c1"># example usage:</span>
<span class="c1"># make all</span>

<span class="nb">all</span> <span class="p">:</span> <span class="n">doc</span><span class="o">/</span><span class="n">count_report</span><span class="o">.</span><span class="n">md</span>

<span class="c1"># count the words</span>
<span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span>
<span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span>
<span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span>
<span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span> <span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">txt</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span> <span class="n">data</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">txt</span> <span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span>
	
<span class="c1"># create the plots</span>
<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span>
<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>	
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span>
<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>	
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">png</span>
<span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">png</span> <span class="p">:</span> <span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span>	
	<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">plotcount</span><span class="o">.</span><span class="n">py</span> <span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">png</span>
	
<span class="c1"># write the report</span>
<span class="n">doc</span><span class="o">/</span><span class="n">count_report</span><span class="o">.</span><span class="n">md</span> <span class="p">:</span> <span class="n">doc</span><span class="o">/</span><span class="n">count_report</span><span class="o">.</span><span class="n">Rmd</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">png</span>
	<span class="n">Rscript</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;rmarkdown::render(&#39;doc/count_report.Rmd&#39;)&quot;</span>
	
<span class="n">clean</span> <span class="p">:</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">results</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">dat</span> <span class="n">results</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">dat</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">isles</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">abyss</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">last</span><span class="o">.</span><span class="n">png</span> <span class="n">results</span><span class="o">/</span><span class="n">figure</span><span class="o">/</span><span class="n">sierra</span><span class="o">.</span><span class="n">png</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">doc</span><span class="o">/</span><span class="n">count_report</span><span class="o">.</span><span class="n">md</span> <span class="n">doc</span><span class="o">/</span><span class="n">count_report</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
</div>
<div class="section" id="pattern-matching-and-variables-in-a-makefile">
<h3>Pattern matching and variables in a Makefile<a class="headerlink" href="#pattern-matching-and-variables-in-a-makefile" title="Permalink to this headline">¶</a></h3>
<p>It is possible to DRY out a Makefile and use variables.</p>
<p>Using wild cards and pattern matching in a makefile is possible, but the syntax is not very readable. So if you choose to do this proceed with caution. Example of how to do this are here: http://swcarpentry.github.io/make-novice/05-patterns/index.html</p>
<p>As for variables in a Makefile, in most cases we actually do not want to do this. The reason is that we want this file to be a record of what we did to run our analysis (e.g., what files were used, what settings were used, etc). If you start using variables with your Makefile, then you are shifting the problem of recording how your analysis was done to another file. There needs to be some file in your repo that captures what variables were called so that you can replicate your analysis. Examples of using variables in a Makefile are here: http://swcarpentry.github.io/make-novice/06-variables/index.html</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./materials/lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="06-intro-to-testing-code.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Introduction to testing code for data science</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="08-reproducible-reports.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reproducible reports</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Tiffany Timbers<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>